"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react");function t(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&o.firstChild?o.insertBefore(i,o.firstChild):o.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}var n,o,i,r,a,d;t(".fable-embed{background-color:#fff}"),"function"==typeof SuppressedError&&SuppressedError,function(e){e.DemoLoadingStarted="demo-loading-started",e.DemoLoadingFinished="demo-loading-finished",e.OnNavigation="on-navigation",e.JourneySwitch="journey-switch",e.NavToAnnotation="navigate-to-annotation"}(n||(n={})),function(e){e.Large="large",e.Medium="medium",e.Small="small"}(o||(o={})),function(e){e.Primary="primary",e.Link="link",e.Outline="outline"}(i||(i={})),function(e){e.TOP_LEFT="c-top-left",e.TOP_CENTER="c-top-center",e.TOP_RIGHT="c-top-right",e.RIGHT_TOP="c-right-top",e.RIGHT_CENTER="c-right-center",e.RIGHT_BOTTOM="c-right-bottom",e.BOTTOM_RIGHT="c-bottom-right",e.BOTTOM_CENTER="c-bottom-center",e.BOTTOM_LEFT="c-bottom-left",e.LEFT_BOTTOM="c-left-bottom",e.LEFT_CENTER="c-left-center",e.LEFT_TOP="c-left-top"}(r||(r={})),function(e){e.Auto="auto"}(a||(a={})),function(e){e.BottomRight="bottom-right",e.BottomLeft="bottom-left",e.Center="center",e.Follow="follow"}(d||(d={}));const l=t=>(e.useEffect((()=>{function e(e){if(e.data.type===n.OnNavigation&&t.onAnnotationChange){const n=e.data.payload;if(t.demoRid!==n.demoRid)return;t.onAnnotationChange(n.currentAnnotationRefId,n.journeyIndex)}if(e.data.type===n.DemoLoadingFinished&&t.onLoaded){const n=e.data.payload;if(t.demoRid!==n.demoRid)return;t.onLoaded(n.annConfigs,n.journeyData)}}return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}}),[t.onLoaded,t.onAnnotationChange]),e.createElement("iframe",{ref:t.innerRef,style:Object.assign({border:"1px solid rgba(0, 0, 0, 0.1)",width:"100%",height:"100%",marginTop:"1rem"},t.style),height:"100%",className:"fable-embed",src:((e,n)=>{const o=t.origin||"https://app.sharefable.com",i=n||{hm:1,ha:1},r=JSON.stringify(i),a=encodeURIComponent(btoa(r));return new URL(`p/demo/${e}?c=${a}`,o).href})(t.demoRid),allowFullScreen:!0,id:"sharefable"}));t('.fable-hoc{background:transparent;display:flex;flex-direction:column;height:auto;max-width:1440px;width:100%}.fable-hoc .con-module-f-hoc{display:flex;flex:0 0 auto;flex-direction:row;flex-wrap:nowrap;gap:2.6rem;overflow-x:auto;padding:1rem}.fable-hoc .con-module-f-hoc .journey-data{color:#333;flex:none;position:relative}.fable-hoc .con-module-f-hoc .journey-data h1{font-size:1rem;font-weight:700}.fable-hoc .con-module-f-hoc .journey-data:not(:last-child):after{border-right:3px solid #000;border-top:3px solid #000;content:"";height:1.4rem;position:absolute;right:-1.3rem;top:50%;transform:translate(.3rem,-50%) rotate(45deg);transform-origin:center;width:1.4rem}.fable-hoc .con-fable-hoc{display:grid;gap:1rem;position:relative;width:100%}.fable-hoc .con-fable-hoc .con-demo{height:fit-content;position:sticky;width:100%;z-index:1}.fable-hoc .con-fable-hoc .con-buttons{align-items:center;display:flex;gap:2rem;justify-content:end}.fable-hoc .con-fable-hoc .con-buttons .fable-nav{background:rgba(0,0,0,.1);cursor:pointer;padding:1rem}.fable-hoc .con-fable-hoc .con-ann-text{display:flex;flex-direction:column;height:100%;margin:1rem auto;max-height:100%;scrollbar-width:thin}.fable-hoc .con-fable-hoc .con-text-journey{border-bottom:1px solid #bbb;display:flex;flex-direction:column;gap:.4rem;padding:.4rem}.fable-hoc .con-fable-hoc .con-text-journey .journey-title{color:#333;font-size:1.2rem;font-weight:700;margin-bottom:.4rem;text-align:center}.fable-hoc .con-fable-hoc .ann-text{border-radius:.5rem;padding:1rem;transition:box-shadow .8s ease;transition:visibility .3s ease-out}.fable-hoc .con-fable-hoc .ann-text .ann-number{align-items:center;aspect-ratio:1/1;background:#e78895;border-radius:1rem;color:#fff;display:flex;font-size:.8rem;font-weight:700;height:fit-content;justify-content:center;min-height:fit-content;min-width:fit-content;padding:.4rem;width:2rem}');const c=(e,t)=>{var n;const o=t.current;o&&(null===(n=o.contentWindow)||void 0===n||n.postMessage({type:"navigate-to-annotation",sender:"sharefable.com",payload:{action:e}},"*"))};t(".ann-text{border-radius:.5rem;padding:1rem;transition:box-shadow .8s ease}.ann-text .ann-number{align-items:center;aspect-ratio:1/1;background:#e78895;border-radius:1rem;color:#fff;display:flex;font-size:.8rem;font-weight:700;height:fit-content;justify-content:center;max-height:1.6rem;max-width:1.6rem;padding:.4rem;width:1.6rem}");const s=t=>e.createElement("div",{style:{boxShadow:t.currAnnRefId===t.ann.refId?"0 0 0 2px rgba(0, 0, 0)":"",position:"stacked"===t.layout?"sticky":"static",top:"stacked"===t.layout?"50px":"auto"},className:"ann-text",key:t.ann.refId,"data-f-id":t.ann.refId,"data-f-annidx":t.idx,onClick:()=>{t.handleAnnotationClick(t.idx,t.jIdx)}},e.createElement("div",{style:{display:"flex",gap:"0.4rem",width:"100%"}},e.createElement("span",{className:"ann-number"},t.idx+1),e.createElement("p",{style:{margin:0}},t.ann.displayText)));exports.default=t=>{var{layout:n="sidebyside",origin:o,demoRid:i,contentWidthPercentage:r=30,stopDuration:a=1e3,top:d}=t,f=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n}(t,["layout","origin","demoRid","contentWidthPercentage","stopDuration","top"]);const[m,u]=e.useState(""),[h,p]=e.useState(!1),[g,b]=e.useState(null),[y,v]=e.useState(0),[x,w]=e.useState([]),E=e.useRef(null),I=e.useRef(null),T=e.useRef(null),[O,R]=e.useState(!1),k=e.useRef(null);e.useEffect((()=>{k.current&&(m===k.current.destinationRefId?(R(!1),k.current=null):setTimeout((()=>{c(k.current.direction,E)}),a<=600?600:a))}),[m]);const C=(e,t=0)=>{if(O)return;let n,o,i;const r=e;let d=0;g&&g.length>0?(n=t,o=y,i=g[o].annsInOrder.findIndex((e=>e.refId===m)),d=((e,t,n,o,i)=>{let r=0;if(o!==n){const a=Math.min(o,n),d=Math.max(o,n);for(let e=a+1;e<d;e++)r+=i[e].annsInOrder.length;r+=n-o>=1?i[o].annsInOrder.length-t+e:e-i[n].annsInOrder.length-t}else r=e-t;return r})(r,i,n,o,g)):(i=x.findIndex((e=>e.refId===m)),d=r-i),((e,t,n,o,i)=>{if(0===e)return void R(!1);if(R(!0),i&&void 0!==n&&void 0!==t&&e<0){if(t===n){const t=i[n].annsInOrder[o].refId;return k.current={direction:e<0?"prev":"next",destinationRefId:t},void c(e<0?"prev":"next",E)}{const n=i[t],r=n.annsInOrder[0].refId;if(((e,t,n)=>{var o;const i=n.current;i&&(null===(o=i.contentWindow)||void 0===o||o.postMessage({type:"navigate-to-annotation",sender:"sharefable.com",payload:{main:`${e}/${t}`}},"*"))})(n.annsInOrder[0].screenId,r,E),v(t),u(r),0===o)return void R(!1);e=o}}const r=x&&x.length>0?x[o].refId:i[t].annsInOrder[o].refId;k.current={direction:e<0?"prev":"next",destinationRefId:r},setTimeout((()=>{c(e<0?"prev":"next",E)}),a<=600?600:a)})(d,n,o,r,g)},j=e.useCallback(((e,t)=>{if(p(!0),e&&e.length)return w(e),void u(e[0].refId);b(t),(null==t?void 0:t.length)&&u(t[0].annsInOrder[0].refId)}),[]),N=e.useCallback(((e,t)=>{u(e),v(t||0)}),[]);return e.useEffect((()=>{var e,t;if(!h)return;const o=null===(e=T.current)||void 0===e?void 0:e.querySelector(`[data-f-id="${m}"]`);if(o)if("sidebyside"===n){const e=o.offsetTop-window.innerHeight/2;window.scrollTo({top:e,behavior:"smooth"})}else{const e=null===(t=I.current)||void 0===t?void 0:t.getBoundingClientRect().bottom,n=o.getBoundingClientRect().top,i=o.getBoundingClientRect().height;window.scrollBy({top:n-e-i,behavior:"smooth"})}}),[m]),e.useEffect((()=>{if("sidebyside"===n&&!h)return;const e=()=>{const e=I.current;if(!e)return;(e=>{var t;const o=null===(t=T.current)||void 0===t?void 0:t.querySelectorAll(".ann-text");o&&o.forEach((t=>{const o=t.getBoundingClientRect();console.log(e.bottom,o.bottom,e.y,t),"stacked"===n&&(e.bottom-o.height-30<o.top&&e.top>0?t.style.visibility="visible":t.style.visibility="hidden"),"sidebyside"===n&&(e.bottom<o.bottom&&e.top>o.top?t.style.visibility="visible":t.style.visibility="hidden")}))})(e.getBoundingClientRect())};return window.addEventListener("scroll",e),()=>{window.removeEventListener("scroll",e)}}),[n,h]),e.createElement("div",Object.assign({className:"fable-hoc"},f),e.createElement("div",{className:"con-module-f-hoc"},g&&(null==g?void 0:g.map((t=>e.createElement("div",{className:"journey-data",key:`journey-${t.main}`},e.createElement("h1",null,t.header1),e.createElement("p",null,t.header2)))))),e.createElement("div",{className:"con-fable-hoc",style:{gridTemplateColumns:"stacked"===n?"1fr":`${r}% auto`,gridTemplateRows:"stacked"===n?"auto 1fr":"1fr"}},e.createElement("div",{className:"con-demo",ref:I,style:{top:"sidebyside"===n?d||"1.5rem":d||"170px"}},e.createElement(l,{origin:o,demoRid:i,onLoaded:j,innerRef:E,onAnnotationChange:N,style:{minHeight:"sidebyside"===n?"40rem":"30rem",marginTop:"0"}}),e.createElement("div",{className:"con-buttons"},e.createElement("span",{className:"fable-nav",onClick:()=>c("prev",E)},"Prev"),e.createElement("span",{className:"fable-nav",onClick:()=>c("next",E)},"Next"))),e.createElement("div",{ref:T,className:"con-ann-text",style:{cursor:O?"progress":"pointer",position:"stacked"===n?"sticky":"static",top:"stacked"===n?"1.5rem":"auto",order:"sidebyside"===n?-1:0,width:"stacked"===n?r+"%":"auto"}},g&&(null==g?void 0:g.map(((t,o)=>e.createElement("div",{key:t.main,className:"con-text-journey"},e.createElement("h3",{className:"journey-title"},t.header1),t.annsInOrder.map(((t,i)=>e.createElement(s,{ann:t,idx:i,jIdx:o,handleAnnotationClick:C,currAnnRefId:m,key:t.refId,layout:n}))))))),x&&x.length>0&&x.map(((t,o)=>e.createElement(s,{ann:t,idx:o,handleAnnotationClick:C,currAnnRefId:m,key:t.refId,layout:n}))))))};
//# sourceMappingURL=fable-hoc.cjs.map

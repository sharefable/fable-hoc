"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t,n,o,a,r,i=require("react");function d(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===n&&o.firstChild?o.insertBefore(a,o.firstChild):o.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}}d(".fable-embed{background-color:#fff}"),"function"==typeof SuppressedError&&SuppressedError,function(e){e.DemoLoadingStarted="demo-loading-started",e.DemoLoadingFinished="demo-loading-finished",e.OnNavigation="on-navigation",e.JourneySwitch="journey-switch",e.NavToAnnotation="navigate-to-annotation"}(e||(e={})),function(e){e.Large="large",e.Medium="medium",e.Small="small"}(t||(t={})),function(e){e.Primary="primary",e.Link="link",e.Outline="outline"}(n||(n={})),function(e){e.TOP_LEFT="c-top-left",e.TOP_CENTER="c-top-center",e.TOP_RIGHT="c-top-right",e.RIGHT_TOP="c-right-top",e.RIGHT_CENTER="c-right-center",e.RIGHT_BOTTOM="c-right-bottom",e.BOTTOM_RIGHT="c-bottom-right",e.BOTTOM_CENTER="c-bottom-center",e.BOTTOM_LEFT="c-bottom-left",e.LEFT_BOTTOM="c-left-bottom",e.LEFT_CENTER="c-left-center",e.LEFT_TOP="c-left-top"}(o||(o={})),(a||(a={})).Auto="auto",function(e){e.BottomRight="bottom-right",e.BottomLeft="bottom-left",e.Center="center",e.Follow="follow"}(r||(r={}));const l=t=>(i.useEffect((()=>{function n(n){if(n.data.type===e.OnNavigation&&t.onAnnotationChange){const e=n.data.payload;if(t.demoRid!==e.demoRid)return;t.onAnnotationChange(e.currentAnnotationRefId,e.journeyIndex)}if(n.data.type===e.DemoLoadingFinished&&t.onLoaded){const e=n.data.payload;if(t.demoRid!==e.demoRid)return;t.onLoaded(e.annConfigs,e.journeyData)}}return window.addEventListener("message",n),()=>{window.removeEventListener("message",n)}}),[t.onLoaded,t.onAnnotationChange]),i.createElement("iframe",{ref:t.innerRef,style:Object.assign({border:"1px solid rgba(0, 0, 0, 0.1)",width:"100%",height:"100%",marginTop:"1rem"},t.style),height:"100%",className:"fable-embed",src:((e,n)=>{const o=t.origin||"https://app.sharefable.com",a={hm:1,ha:1},r=JSON.stringify(a),i=encodeURIComponent(btoa(r));return new URL(`p/demo/${e}?c=${i}`,o).href})(t.demoRid),allowFullScreen:!0,id:"sharefable"}));d('.fable-hoc{background:transparent;display:flex;flex-direction:column;height:auto;max-width:1440px;width:100%}.fable-hoc .con-module-f-hoc{display:flex;flex:0 0 auto;flex-direction:row;flex-wrap:nowrap;gap:2.6rem;overflow-x:auto;padding:1rem}.fable-hoc .con-module-f-hoc .journey-data{color:#333;flex:none;position:relative}.fable-hoc .con-module-f-hoc .journey-data h1{font-size:1rem;font-weight:700}.fable-hoc .con-module-f-hoc .journey-data:not(:last-child):after{border-right:3px solid #000;border-top:3px solid #000;content:"";height:1.4rem;position:absolute;right:-1.3rem;top:50%;transform:translate(.3rem,-50%) rotate(45deg);transform-origin:center;width:1.4rem}.fable-hoc .con-fable-hoc{display:grid;gap:1rem;position:relative;width:100%}.fable-hoc .con-fable-hoc .con-demo{height:fit-content;position:sticky;width:100%;z-index:1}.fable-hoc .con-fable-hoc .con-buttons{align-items:center;display:flex;gap:2rem;justify-content:end}.fable-hoc .con-fable-hoc .con-buttons .fable-nav{background:rgba(0,0,0,.1);cursor:pointer;padding:1rem}.fable-hoc .con-fable-hoc .con-ann-text{display:flex;flex-direction:column;height:100%;margin:1rem auto;max-height:100%;scrollbar-width:thin}.fable-hoc .con-fable-hoc .con-text-journey{border-bottom:1px solid #bbb;display:flex;flex-direction:column;gap:.4rem;padding:.4rem}.fable-hoc .con-fable-hoc .con-text-journey .journey-title{color:#333;font-size:1.2rem;font-weight:700;margin-bottom:.4rem;text-align:center}.fable-hoc .con-fable-hoc .ann-text{border-radius:.5rem;padding:1rem;transition:box-shadow .8s ease;transition:visibility .3s ease-out}.fable-hoc .con-fable-hoc .ann-text .ann-number{align-items:center;aspect-ratio:1/1;background:#e78895;border-radius:1rem;color:#fff;display:flex;font-size:.8rem;font-weight:700;height:fit-content;justify-content:center;min-height:fit-content;min-width:fit-content;padding:.4rem;width:2rem}');const c=(e,t)=>{var n;const o=t.current;o&&(null===(n=o.contentWindow)||void 0===n||n.postMessage({type:"navigate-to-annotation",sender:"sharefable.com",payload:{action:e}},"*"))};d(".ann-text{border-radius:.5rem;padding:1rem;transition:box-shadow .8s ease}.ann-text .ann-number{align-items:center;aspect-ratio:1/1;background:#e78895;border-radius:1rem;color:#fff;display:flex;font-size:.8rem;font-weight:700;height:fit-content;justify-content:center;max-height:1.6rem;max-width:1.6rem;padding:.4rem;width:1.6rem}");const s=e=>i.createElement("div",{style:{boxShadow:e.currAnnRefId===e.ann.refId?"0 0 0 2px rgba(0, 0, 0)":"",position:"stacked"===e.layout?"sticky":"static",top:"stacked"===e.layout?"50px":"auto"},className:"ann-text",key:e.ann.refId,"data-f-id":e.ann.refId,"data-f-annidx":e.idx,onClick:()=>{e.handleAnnotationClick(e.idx,e.jIdx)}},i.createElement("div",{style:{display:"flex",gap:"0.4rem",width:"100%"}},i.createElement("span",{className:"ann-number"},e.idx+1),i.createElement("p",{style:{margin:0}},e.ann.displayText)));exports.default=e=>{var{layout:t="sidebyside",origin:n,demoRid:o,contentWidthPercentage:a=30,stopDuration:r=1e3,top:d}=e,f=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]])}return n}(e,["layout","origin","demoRid","contentWidthPercentage","stopDuration","top"]);const[m,u]=i.useState(""),[h,p]=i.useState(!1),[g,b]=i.useState(null),[y,v]=i.useState(0),[x,w]=i.useState([]),E=i.useRef(null),I=i.useRef(null),T=i.useRef(null),[O,R]=i.useState(!1),k=i.useRef(null);i.useEffect((()=>{k.current&&(m===k.current.destinationRefId?(R(!1),k.current=null):setTimeout((()=>{c(k.current.direction,E)}),r<=600?600:r))}),[m]);const C=(e,t=0)=>{if(O)return;let n,o,a;const i=e;let d=0;g&&g.length>0?(n=t,o=y,a=g[o].annsInOrder.findIndex((e=>e.refId===m)),d=((e,t,n,o,a)=>{let r=0;if(o!==n){const i=Math.min(o,n),d=Math.max(o,n);for(let e=i+1;e<d;e++)r+=a[e].annsInOrder.length;r+=n-o>=1?a[o].annsInOrder.length-t+e:e-a[n].annsInOrder.length-t}else r=e-t;return r})(i,a,n,o,g)):(a=x.findIndex((e=>e.refId===m)),d=i-a),((e,t,n,o,a)=>{if(0===e)return void R(!1);if(R(!0),a&&void 0!==n&&void 0!==t&&e<0){if(t===n){const t=a[n].annsInOrder[o].refId;return k.current={direction:e<0?"prev":"next",destinationRefId:t},void c(e<0?"prev":"next",E)}{const n=a[t],r=n.annsInOrder[0].refId;if(((e,t,n)=>{var o;const a=n.current;a&&(null===(o=a.contentWindow)||void 0===o||o.postMessage({type:"navigate-to-annotation",sender:"sharefable.com",payload:{main:`${e}/${t}`}},"*"))})(n.annsInOrder[0].screenId,r,E),v(t),u(r),0===o)return void R(!1);e=o}}const i=x&&x.length>0?x[o].refId:a[t].annsInOrder[o].refId;k.current={direction:e<0?"prev":"next",destinationRefId:i},setTimeout((()=>{c(e<0?"prev":"next",E)}),r<=600?600:r)})(d,n,o,i,g)},j=i.useCallback(((e,t)=>{if(p(!0),e&&e.length)return w(e),void u(e[0].refId);b(t),(null==t?void 0:t.length)&&u(t[0].annsInOrder[0].refId)}),[]),N=i.useCallback(((e,t)=>{u(e),v(t||0)}),[]);return i.useEffect((()=>{var e,n;if(!h)return;const o=null===(e=T.current)||void 0===e?void 0:e.querySelector(`[data-f-id="${m}"]`);if(o)if("sidebyside"===t){const e=o.offsetTop-window.innerHeight/2;window.scrollTo({top:e,behavior:"smooth"})}else{const e=null===(n=I.current)||void 0===n?void 0:n.getBoundingClientRect().bottom,t=o.getBoundingClientRect().top,a=o.getBoundingClientRect().height;window.scrollBy({top:t-e-a,behavior:"smooth"})}}),[m]),i.useEffect((()=>{if("sidebyside"===t&&!h)return;const e=()=>{const e=I.current;e&&(e=>{var n;const o=null===(n=T.current)||void 0===n?void 0:n.querySelectorAll(".ann-text");o&&o.forEach((n=>{const o=n.getBoundingClientRect();console.log(e.bottom,o.bottom,e.y,n),"stacked"===t&&(e.bottom-o.height-30<o.top&&e.top>0?n.style.visibility="visible":n.style.visibility="hidden")}))})(e.getBoundingClientRect())};return window.addEventListener("scroll",e),()=>{window.removeEventListener("scroll",e)}}),[t,h]),i.createElement("div",Object.assign({className:"fable-hoc"},f),i.createElement("div",{className:"con-module-f-hoc"},g&&(null==g?void 0:g.map((e=>i.createElement("div",{className:"journey-data",key:`journey-${e.main}`},i.createElement("h1",null,e.header1),i.createElement("p",null,e.header2)))))),i.createElement("div",{className:"con-fable-hoc",style:{gridTemplateColumns:"stacked"===t?"1fr":`${a}% auto`,gridTemplateRows:"stacked"===t?"auto 1fr":"1fr"}},i.createElement("div",{className:"con-demo",ref:I,style:{top:"sidebyside"===t?d||"1.5rem":d||"170px"}},i.createElement(l,{origin:n,demoRid:o,onLoaded:j,innerRef:E,onAnnotationChange:N,style:{minHeight:"sidebyside"===t?"40rem":"30rem",marginTop:"0"}}),i.createElement("div",{className:"con-buttons"},i.createElement("span",{className:"fable-nav",onClick:()=>c("prev",E)},"Prev"),i.createElement("span",{className:"fable-nav",onClick:()=>c("next",E)},"Next"))),i.createElement("div",{ref:T,className:"con-ann-text",style:{cursor:O?"progress":"pointer",position:"stacked"===t?"sticky":"static",top:"stacked"===t?"1.5rem":"auto",order:"sidebyside"===t?-1:0,width:"stacked"===t?a+"%":"auto"}},g&&(null==g?void 0:g.map(((e,n)=>i.createElement("div",{key:e.main,className:"con-text-journey"},i.createElement("h3",{className:"journey-title"},e.header1),e.annsInOrder.map(((e,o)=>i.createElement(s,{ann:e,idx:o,jIdx:n,handleAnnotationClick:C,currAnnRefId:m,key:e.refId,layout:t}))))))),x&&x.length>0&&x.map(((e,n)=>i.createElement(s,{ann:e,idx:n,handleAnnotationClick:C,currAnnRefId:m,key:e.refId,layout:t}))))))};
//# sourceMappingURL=fable-hoc.min.cjs.map
